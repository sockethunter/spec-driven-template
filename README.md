# Spec-Driven Development Template

A template for spec-driven development with automated Claude Code hooks for VSCode.

---

## ğŸš€ How It Works

This template enables automated development powered by Claude Code, triggered on file changes:

### Spec-Driven Implementation

- **Trigger**: Changes to `docs/Spec.md`
- **Hook**: `hooks/spec-driven-impl`
- **Function**: Claude reads the Markdown tasks and implements them automatically
- **Format**: Checklist items are marked `[x]` after implementation, with added notes

> âš ï¸ Do **not** edit `docs/Tasks.md` manually â€“ it's auto-managed by Claude.

### Bug-Driven Development

- **Trigger**: Changes to `docs/Bugs.md`
- **Hook**: `hooks/spec-driven-bug`
- **Function**: Claude analyzes and fixes documented bugs

### Automated Documentation

#### Kotlin (.kt files)

- **Hook**: `hooks/docgen/kdoc`
- **Tool**: Uses Detekt to detect undocumented functions
- **Function**: Adds missing KDoc comments
- **Model**: `haiku` (lightweight, fast)

#### JS/TS (.js, .ts, .tsx, .jsx)

- **Hook**: `hooks/docgen/jsdoc`
- **Function**: Adds JSDoc comments to JS/TS functions
- **Model**: `haiku`

### ğŸ§­ Status bar in VSCode

Whenever a hook is triggered (e.g., by saving `Spec.md` or `Bugs.md`), Claude shows the current process in the **VSCode status bar**.

> This lets you quickly see whether Claude is actively working or ready for the next task.

## âš™ï¸ Setup

### 1. Install VSCode Extension

```bash
code --install-extension emeraldwalk.RunOnSave
```

### 2. Install Claude CLI

```bash
npm install -g @anthropic/claude-cli
```

âš ï¸ Warning: Using --bypassPermissions

Some hooks (like spec-driven-impl or spec-driven-bug) may use the --bypassPermissions flag to allow Claude full access to your project files.

When enabled, this allows Claude to:
â€¢ âœ… Read and write files in your workspace
â€¢ âœ… Modify Markdown checklists and source code
â€¢ âœ… Execute logic based on your prompt & automation rules

However, Claude is strictly instructed not to:
â€¢ âŒ Access external networks or APIs
â€¢ âŒ Change files outside of docs/, src/, or relevant scope
â€¢ âŒ Install packages or modify system-level configuration
â€¢ âŒ Delete unrelated files

Always review Claudeâ€™s changes using Git or version control.
For extra safety, run in a virtualized or sandboxed environment.

### 3. Use the Template

```bash
cp -r specdriven-template my-project/
cd my-project/
chmod +x hooks/*
chmod +x hooks/docgen/*
```

ğŸ“ Structure

```
.
â”œâ”€â”€ .vscode/
â”‚   â”œâ”€â”€ extensions.json       # RunOnSave config
â”‚   â””â”€â”€ settings.json         # Hook definitions
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ Spec.md               # Specs â†’ edited by humans
â”‚   â”œâ”€â”€ Bugs.md               # Bug reports â†’ edited by humans
â”‚   â””â”€â”€ Tasks.md              # Generated by Claude
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ spec-driven           # Core logic for task mapping
â”‚   â”œâ”€â”€ spec-driven-impl      # Implements tasks from Spec.md
â”‚   â”œâ”€â”€ spec-driven-bug       # Fixes bugs from Bugs.md
â”‚   â””â”€â”€ docgen/
â”‚       â”œâ”€â”€ kdoc              # Adds KDoc to Kotlin code
â”‚       â””â”€â”€ jsdoc             # Adds JSDoc to JS/TS code
â””â”€â”€ README.md
```

## ğŸ”§ Configuration

### Environment Variables

```bash
# Generic
export SETTING_MODEL="sonnet"
export SETTING_DEBOUNCE_SECONDS=8
export SETTING_MAX_LINES=1200
export SETTING_TIMEOUT=300

# Kotlin
export KDOC_MODEL="haiku"
export KDOC_MAX_TURNS=10
export KDOC_TIMEOUT=40

# JS/TS
export JSDOC_MODEL="haiku"
export JSDOC_MAX_TURNS=10
export JSDOC_TIMEOUT=40
```

â¸»

## ğŸ’¡ Example Workflow

### 1. Write your spec in docs/Spec.md

```md
# ğŸ“ Specification

## Tasks

- [ ] Implement login form with email & password input
- [ ] Validate email format using RegEx on client side
- [ ] Add "Remember Me" checkbox (optional)
- [ ] Show loading spinner during form submission
```

Claude will auto-generate docs/Tasks.md and code when this file changes.

â¸»

### 2. Save the file

Claude detects the change and generates or updates the relevant code automatically.

### 3. Review the implementation

Check modified files. Tasks in docs/Tasks.md will be marked [x] once done, with notes below.

### 4. Report bugs in docs/Bugs.md

```md
# ğŸ Known Bugs

- [ ] Login form crashes if email input is empty
- [ ] "Remember Me" checkbox doesn't persist value in localStorage
```

Claude will fix them and mark them [x] once completed.

â¸»

## âš¡ Features

- ğŸ•’ Debouncing to prevent rapid re-execution
- ğŸ§  Caching to avoid redundant actions
- ğŸ”’ PID management to avoid conflicts
- ğŸ’» VSCode status integration
- â±ï¸ Timeout handling for stability
- ğŸŒ Supports multiple languages (Kotlin, JS/TS)

â¸»

## ğŸ› ï¸ Development

### Adding Custom Hooks

#### 1. Create your script in hooks/

#### 2. Make it executable:

```bash
chmod +x hooks/my-hook
```

#### 3. Register it in .vscode/settings.json:

```json
{
  "match": "\\.(extension)$",
  "isAsync": true,
  "cmd": "zsh -lc '\"${workspaceFolder}/hooks/my-hook\" \"${file}\" \"${workspaceFolder}\"'"
}
```

Use existing hooks as a base for structure and behavior.

â¸»

## ğŸ§¼ Reset Project State

If something goes wrong or you want to start fresh, you can reset the state of your `docs/` folder:

```bash
rm docs/*
mkdir -p docs
echo -e "# ğŸ“ Specification\n\n- [ ] Example task" > docs/Spec.md
echo -e "# ğŸ Known Bugs\n\n- [ ] Example bug description" > docs/Bugs.md
```

This will:

- ğŸ§¹ Wipe old docs/ content
- ğŸ†• Recreate minimal Spec.md and Bugs.md
- âœ… Let Claude restart from a clean base
